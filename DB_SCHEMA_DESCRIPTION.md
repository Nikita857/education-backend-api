# Структура базы данных образовательной системы

Этот документ описывает структуру таблиц базы данных для образовательной системы, построенной по моделям, найденным в проекте.

## 1. Пользователи и аутентификация

### users
Таблица хранит информацию о пользователях системы.

**Структура:**
- id: integer (identity), первичный ключ
- is_active: boolean, активен ли пользователь
- created_at: timestamp (6) with time zone, default current_timestamp(), время создания
- refresh_token_expiry_date: timestamp (6) with time zone, срок действия refresh-токена
- updated_at: timestamp (6) with time zone, default current_timestamp(), время последнего обновления
- department: varchar(50), отдел
- first_name: varchar(50), имя
- job_title: varchar(50), должность
- last_name: varchar(50), фамилия
- qualification: varchar(50), квалификация
- username: varchar(50), уникальный логин
- email: varchar(100), email (уникальный)
- avatar: varchar(200), ссылка на аватар
- development_goals: TEXT, цели развития
- interests: TEXT, интересы
- password: varchar(255), хэш пароля
- photo_url: varchar(255), ссылка на фото
- refresh_token: varchar(255), refresh-токен
- skills: TEXT, навыки
- sso_id: varchar(255), ID в системе SSO
- roles: varchar(255), роли пользователя

**Особенности:**
- Пароль хранится в зашифрованном виде
- Поддержка refresh-токенов с датой истечения
- Возможность интеграции с SSO
- Пользователи могут быть активны/неактивны

### user_role
Промежуточная таблица для связи пользователей и их ролей (многие-ко-многим).

**Структура:**
- user_id: integer, внешний ключ к users
- roles: varchar(255), значения: ROLE_USER, ROLE_ADMIN, ROLE_MANAGER, ROLE_INSTRUCTOR, ROLE_HR

## 2. Курсы и учебные материалы

### courses
Таблица хранит информацию о курсах.

**Структура:**
- id: integer (identity), первичный ключ
- average_rating: float(53), средняя оценка
- duration_hours: integer, продолжительность в часах
- total_reviews: integer, общее количество отзывов
- category_id: bigint, внешний ключ к course_categories
- created_at: timestamp (6), время создания
- updated_at: timestamp (6), время обновления
- slug: varchar(100), уникальный URL-идентификатор
- title: varchar(100), название
- difficulty_level: varchar(255), уровень сложности: BEGINNER, INTERMEDIATE, ADVANCED, EXPERT
- format: varchar(255), формат: VIDEO, TEXT, SCORM, WEBINAR, INTERACTIVE, SIMULATION, TEST
- image: varchar(255), изображение
- scorm_package_path: varchar(255), путь к SCORM-пакету
- status: varchar(255), статус: ACTIVE, INACTIVE, ARCHIVED
- description: oid, описание (текст большого объема)

### modules
Таблица хранит модули внутри курсов.

**Структура:**
- id: integer (identity), первичный ключ
- course_id: integer (not null), внешний ключ к courses
- slug: varchar(50), уникальный URL-идентификатор
- title: varchar(100), название
- status: varchar(255), статус: ACTIVE, INACTIVE

### lessons
Таблица хранит уроки внутри модулей.

**Структура:**
- id: integer (identity), первичный ключ
- module_id: integer (not null), внешний ключ к modules
- viewing_percentage_threshold: integer, порог просмотра в процентах
- viewing_progress_required: boolean, требуется ли отслеживать прогресс просмотра
- webinar_duration_minutes: integer, продолжительность вебинара в минутах
- content_length: bigint, длина контента
- webinar_start_time: timestamp(6) with time zone, время начала вебинара
- short_description: varchar(50), краткое описание
- title: varchar(100), название
- description: varchar(5000), полное описание
- test_code: varchar(5000), код теста
- content_url: varchar(255), URL контента
- file_path: varchar(255), путь к файлу
- format: varchar(255), формат: VIDEO, TEXT, SCORM, WEBINAR, INTERACTIVE, SIMULATION, TEST
- scorm_package_path: varchar(255), путь к SCORM-пакету
- video: varchar(255), видео
- webinar_url: varchar(255), URL вебинара
- estimated_duration_minutes: integer, оценочная длительность в минутах

### tests
Таблица хранит тесты, связанные с модулями.

**Структура:**
- id: bigint (generated by default as identity), первичный ключ
- module_id: integer (not null), внешний ключ к modules
- max_attempts: integer, максимальное количество попыток
- passing_score: integer, проходной балл (%)
- randomize_questions: boolean, перемешивать ли вопросы
- show_correct_answers: boolean, показывать ли правильные ответы
- time_limit_minutes: integer, ограничение по времени в минутах
- created_at: timestamp(6), время создания
- updated_at: timestamp(6), время обновления
- title: varchar(200), название
- description: varchar(1000), описание

### questions
Таблица хранит вопросы внутри тестов.

**Структура:**
- id: bigint (generated by default as identity), первичный ключ
- test_id: bigint (not null), внешний ключ к tests
- points: integer, баллы за вопрос
- created_at: timestamp(6), время создания
- updated_at: timestamp(6), время обновления
- question_type: varchar(255), тип вопроса: SINGLE_CHOICE, MULTIPLE_CHOICE, TEXT_RESPONSE, MATCHING
- question_text: TEXT, текст вопроса

### answer_options
Таблица хранит варианты ответов для вопросов.

**Структура:**
- id: bigint (generated by default as identity), первичный ключ
- question_id: bigint (not null), внешний ключ к questions
- created_at: timestamp(6), время создания
- updated_at: timestamp(6), время обновления
- is_correct: boolean, правильный ли это вариант
- order_number: integer, номер порядка
- option_text: TEXT, текст варианта ответа

## 3. Прогресс и сертификация

### user_progress
Таблица хранит прогресс пользователей по курсам/модулям/урокам.

**Структура:**
- id: integer (generated by default as identity), первичный ключ
- user_id: integer (not null), внешний ключ к users
- course_id: integer, внешний ключ к courses
- module_id: integer, внешний ключ к modules
- lesson_id: integer, внешний ключ к lessons
- completed_at: TIMESTAMP DEFAULT CURRENT_TIMESTAMP, время завершения

### user_courses
Таблица хранит информацию о регистрации пользователей на курсы.

**Структура:**
- id: integer (generated by default as identity), первичный ключ
- user_id: integer (not null), внешний ключ к users
- course_id: integer (not null), внешний ключ к courses
- enrolled_at: TIMESTAMP DEFAULT CURRENT_TIMESTAMP, время регистрации

### user_course_completions
Таблица хранит информацию о завершении курсов.

**Структура:**
- id: bigint (generated by default as identity), первичный ключ
- user_id: integer (not null), внешний ключ к users
- course_id: integer (not null), внешний ключ к courses
- completion_date: timestamp(6) (not null), дата завершения

### user_module_completions
Таблица хранит информацию о завершении модулей.

**Структура:**
- id: bigint (generated by default as identity), первичный ключ
- user_id: integer (not null), внешний ключ к users
- module_id: integer (not null), внешний ключ к modules
- completion_date: timestamp(6) (not null), дата завершения
- grade: float(53) (not null), оценка

### certificates
Таблица хранит информацию о сертификатах пользователей за пройденные курсы.

**Структура:**
- id: bigint (generated by default as identity), первичный ключ
- user_id: integer (not null), внешний ключ к users
- course_id: integer (not null), внешний ключ к courses
- created_at: timestamp(6) with time zone (not null), дата создания
- title: varchar(200) (not null), название сертификата
- description: varchar(500), описание
- expiry_date: timestamp(6) with time zone, дата окончания действия
- issue_date: timestamp(6) with time zone, дата выдачи
- certificate_file_path: varchar(255), путь к файлу сертификата
- certificate_number: varchar(255), номер сертификата (уникальный)
- certificate_url: varchar(255), URL сертификата

### test_results
Таблица хранит результаты прохождения тестов пользователями.

**Структура:**
- id: bigint (generated by default as identity), первичный ключ
- user_id: integer (not null), внешний ключ к users
- test_id: bigint (not null), внешний ключ к tests
- completed_at: timestamp(6) with time zone (not null), время завершения
- max_score: integer, максимальный балл
- passed: boolean, пройдено ли
- percentage: float(53), процент
- score: integer, набранный балл
- time_spent_seconds: integer, затраченное время в секундах

### module_test_results
Таблица хранит результаты прохождения тестов модулей.

**Структура:**
- id: integer (generated by default as identity), первичный ключ
- user_id: integer (not null), внешний ключ к users
- module_id: integer (not null), внешний ключ к modules
- completion_date: timestamp(6) (not null), дата завершения
- score: integer (not null), набранный балл
- total_questions: integer (not null), общее количество вопросов

## 4. Навыки и компетенции

### skills
Таблица хранит общие навыки/компетенции.

**Структура:**
- id: bigint (generated by default as identity), первичный ключ
- created_at: timestamp(6), время создания
- updated_at: timestamp(6), время обновления
- name: varchar(100) (not null), название (уникальное)
- description: varchar(500), описание
- category: varchar(255), категория

### user_skills
Таблица хранит уровень владения навыками конкретным пользователем.

**Структура:**
- id: bigint (generated by default as identity), первичный ключ
- user_id: integer (not null), внешний ключ к users
- skill_id: bigint (not null), внешний ключ к skills
- created_at: timestamp(6) with time zone (not null), время создания
- updated_at: timestamp(6) with time zone, время обновления
- assessment_method: varchar(255), метод оценки
- last_assessed: timestamp(6) with time zone, когда последний раз оценивался
- proficiency_level: integer, уровень владения (0-5)

## 5. Категории и теги

### course_categories
Таблица хранит категории курсов.

**Структура:**
- id: bigint (generated by default as identity), первичный ключ
- created_at: timestamp(6), время создания
- updated_at: timestamp(6), время обновления
- name: varchar(100) (not null), название
- slug: varchar(100) (not null), URL-идентификатор (уникальный)
- description: varchar(500), описание
- image: varchar(255), изображение

### tags
Таблица хранит теги для различных элементов.

**Структура:**
- id: bigint (generated by default as identity), первичный ключ
- name: varchar(255) (not null), название (уникальное)

### course_tags
Промежуточная таблица для связи курсов и тегов (многие-ко-многим).

**Структура:**
- course_id: integer (not null), внешний ключ к courses
- tag_id: bigint (not null), внешний ключ к tags

### blog_post_tags
Промежуточная таблица для связи блог-постов и тегов (многие-ко-многим).

**Структура:**
- blog_post_id: bigint (not null), внешний ключ к blog_posts
- tag_id: bigint (not null), внешний ключ к tags

## 6. Блоги и обсуждения

### blog_posts
Таблица хранит блог-посты.

**Структура:**
- id: bigint (generated by default as identity), первичный ключ
- author_id: integer (not null), внешний ключ к users
- is_published: boolean, опубликован ли
- view_count: integer, количество просмотров
- created_at: timestamp(6) with time zone (not null), дата создания
- updated_at: timestamp(6) with time zone, дата обновления
- title: varchar(200) (not null), заголовок
- summary: varchar(500), краткое содержание
- image_url: varchar(255), URL изображения
- content: TEXT (not null), содержание

### comments
Таблица хранит комментарии к блог-постам.

**Структура:**
- id: bigint (generated by default as identity), первичный ключ
- user_id: integer (not null), внешний ключ к users
- blog_post_id: bigint (not null), внешний ключ к blog_posts
- is_liked: boolean, понравилось ли
- created_at: timestamp(6) with time zone (not null), дата создания
- updated_at: timestamp(6) with time zone, дата обновления
- content: TEXT (not null), содержание комментария

## 7. Настройки и уведомления

### application_settings
Таблица хранит глобальные настройки приложения.

**Структура:**
- setting_key: varchar(255) (not null), первичный ключ, ключ настройки
- setting_value: TEXT, значение настройки

### notifications
Таблица хранит уведомления для пользователей.

**Структура:**
- id: bigint (generated by default as identity), первичный ключ
- user_id: integer (not null), внешний ключ к users
- is_read: boolean (not null), прочитано ли
- created_at: timestamp(6) with time zone, дата создания
- link: varchar(255), ссылка
- message: varchar(255) (not null), сообщение

## 8. Индивидуальные планы и адаптация

### individual_development_plans
Таблица хранит индивидуальные планы развития.

**Структура:**
- id: bigint (generated by default as identity), первичный ключ
- user_id: integer (not null), внешний ключ к users
- assigned_by_user_id: integer, внешний ключ к users (кто назначил)
- created_at: timestamp(6) with time zone (not null), дата создания
- updated_at: timestamp(6) with time zone, дата обновления
- title: varchar(200) (not null), название
- description: varchar(1000), описание
- start_date: timestamp(6) with time zone, дата начала
- end_date: timestamp(6) with time zone, дата окончания
- status: varchar(255), статус: NEW, IN_PROGRESS, COMPLETED, CANCELLED

### adaptation_programs
Таблица хранит программы адаптации.

**Структура:**
- id: bigint (generated by default as identity), первичный ключ
- user_id: integer (not null), внешний ключ к users (сотрудник)
- mentor_user_id: integer, внешний ключ к users (ментор)
- created_at: timestamp(6) with time zone (not null), дата создания
- updated_at: timestamp(6) with time zone, дата обновления
- title: varchar(200) (not null), название
- description: varchar(1000), описание
- start_date: timestamp(6) with time zone, дата начала
- end_date: timestamp(6) with time zone, дата окончания
- status: varchar(255), статус: NEW, IN_PROGRESS, COMPLETED

## 9. Документация

### documentations
Таблица хранит документацию по курсам.

**Структура:**
- id: bigint (generated by default as identity), первичный ключ
- course_id: integer (уникальный), внешний ключ к courses
- title: varchar(255) (not null), название

### documentation_categories
Таблица хранит категории документации.

**Структура:**
- id: bigint (generated by default as identity), первичный ключ
- documentation_id: bigint, внешний ключ к documentations
- name: varchar(255) (not null), название
- link: varchar(255) (not null), ссылка (уникальная)

### documentation_objects
Таблица хранит объекты документации.

**Структура:**
- id: bigint (generated by default as identity), первичный ключ
- category_id: bigint, внешний ключ к documentation_categories
- name: varchar(255) (not null), название
- text: oid, текст
- file: varchar(255), файл

### documentation_object_tags
Промежуточная таблица для связи объектов документации и тегов (многие-ко-многим).

**Структура:**
- documentation_object_id: bigint (not null), внешний ключ к documentation_objects
- tag_id: bigint (not null), внешний ключ к tags

## 10. Прочие таблицы

### course_reviews
Таблица хранит отзывы пользователей на курсы.

**Структура:**
- id: bigint (generated by default as identity), первичный ключ
- user_id: integer (not null), внешний ключ к users
- course_id: integer (not null), внешний ключ к courses
- created_at: timestamp(6) with time zone (not null), дата создания
- updated_at: timestamp(6) with time zone, дата обновления
- rating: integer (not null), рейтинг (1-5)
- comment: TEXT, комментарий
- уникальное ограничение: (user_id, course_id)

### offers
Таблица для служебных предложений или запросов.

**Структура:**
- id: integer (generated by default as identity), первичный ключ
- user_id: integer (not null), внешний ключ к users
- created_at: timestamp(6) (not null), дата создания
- updated_at: timestamp(6), дата обновления
- topic: varchar(50) (not null), тема
- status: varchar(255) (not null), статус: PENDING, APPROVED, REJECTED, COMPLETED
- description: oid (not null), описание
- response: oid, ответ